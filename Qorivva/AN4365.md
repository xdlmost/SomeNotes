> Qorivva MPC56xx Flash Programming Through Nexus/JTAG
# Qorivva MPC56xx系列 Nexus/JTAG闪存编程
> The Qorivva MPC56xx family of devices has internal
flash memory used for code and data. The MPC56xx
Nexus debug interface can be used to program flash
memory using the JTAG communication protocol
through the JTAG port. This allows programming of the
internal flash memory with an external tool.

Qorivva MPC56xx系列芯片拥有用于存储代码和数据的内建闪存。MPC56xx的Nexus调试接口可以用来为闪存编程，这需要连通JTAG接口，使用JTAG协议。这就是说可以通过外部工具对内建闪存进行编程。
> All MPC56xx devices have versions of the e200zx core
that support variable length encoding (VLE)
instructions. Most MPC56xx devices support both Book
E and VLE instructions; however, some MPC560x
devices utilize the e200z0 core that only supports VLE
instructions. Table 9 shows the core types used on
currently available MPC56xx devices. However, as
different variations of the MPC56xx family will be
released during the lifecycle of this document, it is
important that you confirm the core type on the target
MPC56xx device. For the remainder of this document,
code examples are provided in Book E. If the instruction
example differs when implemented in VLE, the
equivalent VLE instruction is also shown in brackets. 

所有MPC56xx系列芯片都包含一个支持变长编码指令集（下文称VLE）的e200zx内核。大多数MPC56xx系列芯片支持Book E和VLE两种指令集，一些使用了e200z0内核的芯片仅支持VLE指令集。`表9`列出了所有已发布芯片的内核型号，然而在本文档存续期间发布的新型号MPC56xx芯片不会被包含，请另行确认。本文中所有示例代码都会都以Book E指令集编写，如果对应的VLE指令与之不同会在其后的括号中提供。
> For further information on VLE, please consult VLEPM, Variable-Length Encoding (VLE) Programming
Environments Manual, available from freescale.com.

想进一步了解VLE指令集请参阅VLEPM（可以在freescale.com下载）

> This application note is adapted from AN3283, “MPC5500 Flash Programming Through Nexus/JTAG.” It
first addresses the JTAG and Nexus communication protocol. The JTAG discussion includes the JTAG
signals, TAP controller state machine, and the JTAG controller. The explanation of Nexus includes the
on-chip emulation (OnCE) module and the Nexus read/write (R/W) access block. As different versions of
the MPC56xx devices may use different JTAG and Nexus modules, the examples given here are generic
to suit this flash memory programming note. If more detailed information is required for a specific device,
please consult the reference manual.

这篇文档改编自最早阐述Nexus/JTAG通信协议的文章《MPC5500 Nexus/JTAG闪存编程》(AN3283).JTAG部分讨论了包括JTAG信号（JTAG signals）、TAP状态机和JTAG控制器。Nexus部分解释了仿真模块（OnCE）和Nexus块读写（Nexus R/W）。不同型号的MPC56xx系列芯片使用了不同的JTAG、Nexus模块，但是我们的示例代码仅适用于通用的flash。想了解某特定型号芯片的特性，请自行查看参考手册。
> After the communication protocols are described, this document goes into the details of the
Freescale-provided flash memory drivers and the requirements of the external tool for flash programming.
For the purpose of this document, the external tool consists of a PC application combined with interface
hardware that connects the PC to the JTAG port on an MPC56xx board or module.

解释通信协议后，本文档会进一步详解Freescale的flash设备和flash编程的外部工具需求。flash编程的外部工具即包含了软件，也包含了PC与MPC56xx系列芯片的JTAG链接的硬件接口
> This document is intended for anyone wanting to develop a flash memory programming tool for the
MPC56xx family of devices. Someone wanting to learn about the JTAG communication protocol, OnCE
module, or the Nexus R/W access block may also find this application note beneficial.

本文适用于所有有意向开发MPC56xx系列芯片的flash开发工具的人员，同时对想了解JTAG通信协议、仿真模块（OnCE）和Nexus块读写技术的开发在也有帮助。

>1 JTAG  JTAG is a serial communication protocol developed by the Joint Test Access Group. Originally developed
for boundary scan, JTAG is also used for communication with the Nexus debug interface (NDI) on the
MPC56xx devices. Figure 2 shows a block diagram of the NDI.

## 1 JTAG
JTAG是一系列有Joint Test Access Group开发的通信协议，其最初是用来做边界扫描（boundary scan）。同时JTAG也用作与MPC56xx系列芯片的NDI接口（Nexus debug interface）通信。`图2`显示了NDI的结构图。
>1.1 JTAG signals The JTAG port of the MPC56xx devices consists of the TCK, TDI, TDO, TMS, and JCOMP pins. TDI,TDO, TMS, and TCK are compliant with the IEEE 1149.1-2001 standard and are shared with the NDI through the test access port (TAP) interface. See Table 1 for signal properties. 

### 1.1 JTAG 信号（1.1 JTAG signals）
MPC56xx系列芯片的JTAG端口由 *TCK*, *TDI*, *TDO*, *TMS*, and *JCOMP* 引脚组成。其中*TCK*, *TDI*, *TDO*, *TMS*接口符合__IEEE 1149.1-2001__标准，同时这些针脚通过TAP接口可以与NDI共用。`表1`列出了引脚的定义。

|名称|输入or输出|功能|说明
|:-:|:-:|:-:|:-:|
|*TCK*|输入|时钟| |
|*TDI*|输入|数据输入| |
|*TDO*|输出|数据输出| |
|*TMS*|输入|模式选择| |
|*JCOMP*|输入|JTAG Compliancy|没有此引脚的芯片JTAG依旧可用，仅在5个时钟周期TMS高电位的情况下被重置|
|*RDY*|输出|Nexus/JTAG Ready|没有此引脚的芯片无法加速Nexus块转移操作|




